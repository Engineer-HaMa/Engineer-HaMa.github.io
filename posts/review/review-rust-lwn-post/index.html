<!DOCTYPE html>
<html lang="en">
<head>
    
        
    
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        @font-face {
            font-family: "Pretendard-Regular";
            src: url('https://engineer-hama.github.io/fonts/Pretendard-Regular.woff') format("woff");
            font-weight: 400;
            font-style: normal;
        }
        body {
            font-family: "Pretendard-Regular", sans-serif;
        }
    </style>

    
        
    

    <title>How to write Rust in the kernel: 한국어 요약본 | HaMa</title>

    
    

      <!-- SEO: Open Graph / Twitter Card -->
      <meta property="og:title" content="How to write Rust in the kernel: 한국어 요약본 | HaMa" />
      <meta property="og:description" content="" />
      <meta property="og:url" content="https://engineer-hama.github.io" />
      <meta property="og:type" content="website" />
      

      <meta name="twitter:card" content="summary_large_image" />
      <meta name="twitter:title" content="How to write Rust in the kernel: 한국어 요약본" />
      <meta name="twitter:description" content="" />
      
      
      

      <!-- CSS -->
    <link rel="stylesheet" href="https://engineer-hama.github.io/css/main.css">
    <link rel="stylesheet" href="https://engineer-hama.github.io/css/font-awesome.min.css">

    <script src="https://engineer-hama.github.io/js/mermaid.min.js"></script>
    <script src="https://engineer-hama.github.io/js/copy_code.js"></script>
    <script src="https://engineer-hama.github.io/js/copy_heading_link.js"></script>

    
    
</head>
<body>
    



    <div class="drawer lg:drawer-open">
        <input id="my-drawer-2" type="checkbox" class="drawer-toggle" />
        <div class="drawer-content flex flex-col pt-16">
            
<div class="navbar opacity-95 fixed top-0 left-0 right-0 z-50 h-16 border-b border-gray-500/15 backdrop-blur-3xl">
    <!-- Mobile hamburger -->
    <div class="flex-none lg:hidden">
        <label for="my-drawer-2" class="btn btn-square btn-ghost">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-5 h-5 stroke-current"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
        </label>
    </div>
    <!-- Logo -->
    <div class="flex-1">
        <a href="/" class="btn btn-ghost hover:animate-pulse hover:bg-transparent hover:border-transparent normal-case text-xl">
            
                HaMa&#x27;s Blog
            
        </a>
    </div>
    <!-- Desktop Menu -->
    <div class="flex-none hidden lg:flex">
        <ul class="menu menu-horizontal px-1 items-center">
            
            

            
            <li>
                <label class="swap swap-rotate btn btn-ghost">
                  <input type="checkbox" class="theme-controller" value="night" aria-labelledby="swap color"/>
                  <svg class="swap-off h-5 w-5 fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5.64,17l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,5.64,17ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm7-7a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41l-.71-.71A1,1,0,0,0,4.93,6.34Zm12,.29a1,1,0,0,0,.7-.29l.71-.71a1,1,0,1,0-1.41-1.41L17,5.64a1,1,0,0,0,0,1.41A1,1,0,0,0,17.66,7.34ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-9,8a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19ZM18.36,17A1,1,0,0,0,17,18.36l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM12,6.5A5.5,5.5,0,1,0,17.5,12,5.51,5.51,0,0,0,12,6.5Zm0,9A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z" /></svg>
                  <svg class="swap-on h-5 w-5 fill-current" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z" /></svg>
                </label>
            </li>
            

        </ul>
    </div>
</div>


            
            
            <div class="p-8 w-full max-w-7xl mx-auto lg:grid lg:grid-cols-[1fr_250px] lg:gap-8">
                <main class="prose w-full max-w-7xl mx-auto">
            
                    
    <div class="mb-12 pb-4 border-b border-gray-500/15">
        <h1>How to write Rust in the kernel: 한국어 요약본</h1>
        <p class="text-gray-500"></p>
    </div>
    <h1 id="tl-dr">tl;dr</h1>
<p>이 글은은 How to write Rust in the kernel <a href="https://lwn.net/Articles/1024202/">1편</a>,
<a href="https://lwn.net/Articles/1025232/">2편</a> 의 한국어 요약본입니다.
Rust를 커널에서 사용하기 위한 방법과 관련된 내용을 다루고 있습니다.
Linux kernel(이하 커널)에 점차 Rust 코드가 추가되는 상황에서, C개발자가 Rust 코드를 리뷰하기 위해,
그리고 Rust 개발자가 커널 프로젝트에 합류하기 위해 알아야 할 내용들을 다룹니다.</p>
<h1 id="bildeu-siseutem-ihaehagi">빌드 시스템 이해하기</h1>
<p>커널은 C언어 2가지 컴파일러, GCC와 LLVM을 지원합니다. 하지만 Rust는 rustc(LLVM)만 공식적으로 지원중입니다.
gccrs 프로젝트는 커널 코드를 잘 컴파일하지만 아직 공식 지원은 아닙니다.
따라서</p>
<ol>
<li>C는 GCC + Rust는 LLVM</li>
<li>C와 Rust 모두 LLVM</li>
</ol>
<p>이 두 가지 선택지로 빌드할 수 있습니다.
추가로 clippy, rustdoc, rust-analyzer를 설치하면 편리합니다.</p>
<blockquote>
<p>Rust 코드를 활성화하기 위한 커널 플래그에 관한 설명은 생략</p>
</blockquote>
<blockquote>
<p>TODO: 테스팅 요약 추가하기</p>
</blockquote>
<blockquote>
<p>TODO: 포맷팅 설명 추가하기</p>
</blockquote>
<h1 id="kodeu-salpyeobogi">코드 살펴보기</h1>
<p>Asix AX88796B embedded Ethernet controller의 드라이버를 Rust 버전을 작성한 코드를 통해
Rust 커널 코드의 구조를 살펴보겠습니다.</p>
<ul>
<li><a href="https://github.com/torvalds/linux/blob/master/drivers/net/phy/ax88796b.c">C 코드</a></li>
<li><a href="https://github.com/torvalds/linux/blob/master/drivers/net/phy/ax88796b_rust.rs">Rust코드</a></li>
</ul>
<h2 id="rustyi-modyul-siseutem">Rust의 모듈 시스템</h2>
<p>Rust는 C의 헤더 파일 참조와 다르게 모듈 시스템을 통해 원하는 정확한 심볼만 참조 가능합니다.</p>
<pre data-lang="Rust" class="language-Rust "><code class="language-Rust" data-lang="Rust">use kernel::{
    c_str,
    net::phy::{self, reg::C22, DeviceId, Driver},
    prelude::*,
    uapi,
};
</code></pre>
<p>커널에서 사용하는 모든 라이브러리는 kernel crate에 포함되어 있습니다.</p>
<blockquote>
<p>TODO: 매크로, 전역변수(상수)에 관한 설명 추가하기</p>
</blockquote>
<h2 id="rustyi-hamsu-jagseong">Rust의 함수 작성</h2>
<p>이 글은 함수 처리 과정 중 에러 핸들링에 중점을 두고 있습니다. 동일한 기능을 하는 C 코드와 Rust 코드를 비교해보겠습니다.</p>
<pre data-lang="C" class="language-C "><code class="language-C" data-lang="C">static int asix_soft_reset(struct phy_device *phydev)
{
    int ret;

    &#x2F;* Asix PHY won&#x27;t reset unless reset bit toggles *&#x2F;
    ret = phy_write(phydev, MII_BMCR, 0);
    if (ret &lt; 0)
	    return ret;

    return genphy_soft_reset(phydev);
}
</code></pre>
<pre data-lang="Rust" class="language-Rust "><code class="language-Rust" data-lang="Rust">&#x2F;&#x2F; Performs a software PHY reset using the standard
&#x2F;&#x2F; BMCR_RESET bit and poll for the reset bit to be cleared.
&#x2F;&#x2F; Toggle BMCR_RESET bit off to accommodate broken AX8796B
&#x2F;&#x2F; PHY implementation such as used on the Individual
&#x2F;&#x2F; Computers&#x27; X-Surf 100 Zorro card.
fn asix_soft_reset(dev: &amp;mut phy::Device) -&gt; Result {
    dev.write(C22::BMCR, 0)?;
    dev.genphy_soft_reset()
}
</code></pre>
<p>두 구현이 failable한 library 함수를 호출하고 그 결과를 확인하여 이어서 진행화는 과정에서 자동화된 에러 처리를 보여줍니다.</p>
<h2 id="deuraibeo-deungroghagi">드라이버 등록하기</h2>
<blockquote>
<p>TODO: 드라이버 등록 코드 설명하긴</p>
</blockquote>
<h1 id="camgojaryo">참고자료</h1>
<ul>
<li>https://github.com/torvalds/linux/blob/master/drivers/net/phy/ax88796b.c</li>
<li>https://github.com/torvalds/linux/blob/master/drivers/net/phy/ax88796b_rust.rs</li>
<li>https://www.phoronix.com/news/Linux-6.8-Rust-PHY-Driver</li>
</ul>



                    



                    <div class="flex justify-between mt-8">
                        <div class="prev-link">
                            
    
        
        <a class="btn bg-base-100 border border-gray-500/15 shadow-lg rounded-xl transition-transform hover:scale-105 hover:shadow-2xl" href="https://engineer-hama.github.io/posts/review/">‹ Review</a>
    

                        </div>
                        <div class="next-link">
                            
    
        
        
        
            
            
            
        
    

                        </div>
                    </div>
                </main>

                
                    

<div class="hidden lg:block">
    <div class="sticky top-20 px-4 py-2 border-l border-gray-500/15">
        <h4 class="text-lg font-bold mb-1">ON THIS PAGE</h4>
            <ul class="menu menu-sm toc-menu">
            
                <li>
                    
                    <a href="https://engineer-hama.github.io/posts/review/review-rust-lwn-post/#tl-dr" class="toc-link">tl;dr</a>
                    
                </li>
            
                <li>
                    
                    <a href="https://engineer-hama.github.io/posts/review/review-rust-lwn-post/#bildeu-siseutem-ihaehagi" class="toc-link">빌드 시스템 이해하기</a>
                    
                </li>
            
                <li>
                    
                    <details class="toc-details">
                        <summary>
                            <a href="https://engineer-hama.github.io/posts/review/review-rust-lwn-post/#kodeu-salpyeobogi" class="toc-link">코드 살펴보기</a>
                        </summary>
                        <ul>
                            
                                <li>
                                    <a href="https://engineer-hama.github.io/posts/review/review-rust-lwn-post/#rustyi-modyul-siseutem" class="toc-link">Rust의 모듈 시스템</a>
                                </li>
                            
                                <li>
                                    <a href="https://engineer-hama.github.io/posts/review/review-rust-lwn-post/#rustyi-hamsu-jagseong" class="toc-link">Rust의 함수 작성</a>
                                </li>
                            
                                <li>
                                    <a href="https://engineer-hama.github.io/posts/review/review-rust-lwn-post/#deuraibeo-deungroghagi" class="toc-link">드라이버 등록하기</a>
                                </li>
                            
                        </ul>
                    </details>
                    
                </li>
            
                <li>
                    
                    <a href="https://engineer-hama.github.io/posts/review/review-rust-lwn-post/#camgojaryo" class="toc-link">참고자료</a>
                    
                </li>
            
            </ul>
    </div>
</div>


                
                
            </div>

            <script>
              // Determine theme: localStorage > extra.default_colorset > night
              // Expose theme config for global use (e.g., goyo.js)
              window.defaultColorset = "dark";
              window.themeMap = { "dark": "night", "light": "lofi" };
              window.fallbackTheme = window.themeMap[window.defaultColorset] || "night";
              var currentTheme = localStorage.getItem('theme') || window.fallbackTheme;
              var mermaidTheme = "dark";
              if(currentTheme == "lofi") {
                mermaidTheme = "light";
              }
              mermaid.initialize({ startOnLoad: false, theme: mermaidTheme });
              document.addEventListener('DOMContentLoaded', async () => {
                const mermaidElements = document.querySelectorAll('.mermaid');

                if (mermaidElements.length > 0) {
                    await mermaid.run({
                        nodes: mermaidElements
                    });
                }
              });
            </script>

        </div>

        
        
        <div id="sidebar" class="drawer-side fixed top-0 pt-12 bottom-0 z-40 border-r border-gray-500/15">
        
            
                

<label for="my-drawer-2" class="drawer-overlay"></label>
<div class="mt-4 w-68 h-[calc(100vh-4rem)] bg-base-100 text-base-content flex flex-col overflow-auto">
    
    <ul class="menu w-full flex-grow">
        
        
        
            <li ><a class="hover:no-underline" href="https://engineer-hama.github.io/blog"></a></li>
        
            <li ><a class="hover:no-underline" href="https://engineer-hama.github.io/wiki">Wiki</a></li>
        
        
            
            <li>
                
                    <details open>
                        <summary ><a class="hover:no-underline" href="https://engineer-hama.github.io/posts">Posts</a></summary>
                        <ul>
                            
                            
                            
                                
                                <li>
                                    
                                        <details open>
                                            <summary ><a class="hover:no-underline" href="https://engineer-hama.github.io/posts/2025-interview-prepare">2025 석사과정 면접준비</a></summary>
                                            <ul>
                                                
                                                
                                                    <li ><a class="hover:no-underline" href="https://engineer-hama.github.io/posts/2025-interview-prepare/2024-interview-prepare-01-pl">1. PL</a></li>
                                                
                                                    <li ><a class="hover:no-underline" href="https://engineer-hama.github.io/posts/2025-interview-prepare/2024-interview-prepare-02-architecture">2. Architecture</a></li>
                                                
                                                    <li ><a class="hover:no-underline" href="https://engineer-hama.github.io/posts/2025-interview-prepare/2024-interview-prepare-03-os">3. OS</a></li>
                                                
                                                    <li ><a class="hover:no-underline" href="https://engineer-hama.github.io/posts/2025-interview-prepare/2024-interview-prepare-04-db">4. DB</a></li>
                                                
                                                    <li ><a class="hover:no-underline" href="https://engineer-hama.github.io/posts/2025-interview-prepare/2024-interview-prepare-05-math">5. Math</a></li>
                                                
                                                    <li ><a class="hover:no-underline" href="https://engineer-hama.github.io/posts/2025-interview-prepare/2024-interview-prepare-06-network">6. Network</a></li>
                                                
                                                    <li ><a class="hover:no-underline" href="https://engineer-hama.github.io/posts/2025-interview-prepare/2024-interview-prepare-08-ml">8. AI&#x2F;ML</a></li>
                                                
                                                    <li ><a class="hover:no-underline" href="https://engineer-hama.github.io/posts/2025-interview-prepare/2024-interview-prepare-09-algorithm">9. Algorithm</a></li>
                                                
                                                    <li ><a class="hover:no-underline" href="https://engineer-hama.github.io/posts/2025-interview-prepare/2024-interview-prepare-11-security">11. Security</a></li>
                                                
                                                
                                            </ul>
                                        </details>
                                    
                                </li>
                            
                                
                                <li>
                                    
                                        <details open>
                                            <summary ><a class="hover:no-underline" href="https://engineer-hama.github.io/posts/review">Review</a></summary>
                                            <ul>
                                                
                                                
                                                    <li ><a class="hover:no-underline" href="https://engineer-hama.github.io/posts/review/review-asterinas">논문 리뷰: Asterinas: A Linux ABI-Compatible, Rust-Based Framekernel OS with a Small and Sound TCB</a></li>
                                                
                                                    <li ><a class="hover:no-underline" href="https://engineer-hama.github.io/posts/review/review-omniglot">논문 리뷰: Building Bridges: Safe Interactions with Foreign Languages through Omniglot</a></li>
                                                
                                                    <li class="rounded bg-gray-500/15"><a class="hover:no-underline" href="https://engineer-hama.github.io/posts/review/review-rust-lwn-post">How to write Rust in the kernel: 한국어 요약본</a></li>
                                                
                                                
                                            </ul>
                                        </details>
                                    
                                </li>
                            
                                
                                <li>
                                    <a  href="https://engineer-hama.github.io/posts/talks">Talks</a>
                                </li>
                            
                        </ul>
                    </details>
                
            </li>
        
    </ul>

    
<footer class="footer text-xs pt-4 px-4 text-base-content border-t border-gray-500/15">
    <aside>
        <p>
            Powered by <a href='https://www.getzola.org'>Zola</a> and <a href='https://github.com/hahwul/goyo'>Goyo</a>
        </p>
    </aside>
</footer>

</div>

            
        </div>
    </div>

    
        
        <script type="text/javascript" src="https://engineer-hama.github.io/goyo.js"></script>
    
</body>
</html>
